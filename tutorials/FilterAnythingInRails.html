<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" size="180x180"><link rel="icon" type="image.png" href="/favicon-32x32.png" size="32x32"><link rel="icon" type="image.png" href="/favicon-16x16.png" size="16x16"><link rel="manifest" href="/site.webmanifest"><link rel="stylesheet" href="/styles/index.css"><meta property="og:type" content="website"><meta property="og:url" content="https://suchdevblog.com/"><meta property="og:title" content="Such Dev Blog"><meta property="og:description" content="Much code, very webdev. A blog by Samuel Faure about web development, Ruby on Rails, Node.js, and more."><meta property="og:image" content="https://suchdevblog.com/images/devpic.webp"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://suchdevblog.com/"><meta name="twitter:title" content="Such Dev Blog"><meta name="twitter:description" content="Much code, very webdev. A blog by Samuel Faure about web development, Ruby on Rails, Node.js, and more."><meta name="twitter:image" content="https://suchdevblog.com/images/devpic.webp"><meta name="author" content="Samuel Faure"><meta name="keywords" content="web development, Ruby on Rails, Node.js, fullstack, developer, blog, tutorials, programming"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><script data-goatcounter="https://suchdevblog.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script><title>💎 Filter Anything in a Rails request in 10 lines of code | Such Dev Blog</title><meta name="description" content="Wow Rails, Has scope, Very powerful">
    <link rel="preload" href="/assets/style-Pd9_wNba.css" as="style"><link rel="stylesheet" href="/assets/style-Pd9_wNba.css">
    <link rel="modulepreload" href="/assets/app-wnH-bxgu.js"><link rel="modulepreload" href="/assets/FilterAnythingInRails.html-DPeKoRrM.js">
    <link rel="prefetch" href="/assets/Portfolio.html-C6Rmi74G.js" as="script"><link rel="prefetch" href="/assets/index.html-CXnzzwTA.js" as="script"><link rel="prefetch" href="/assets/WhoAmI.html-MdILxMwe.js" as="script"><link rel="prefetch" href="/assets/lessons.html-LG327zce.js" as="script"><link rel="prefetch" href="/assets/opinions.html-C9VKvfnJ.js" as="script"><link rel="prefetch" href="/assets/resources.html-B_-loIDW.js" as="script"><link rel="prefetch" href="/assets/tutorials.html-C_r2JmYH.js" as="script"><link rel="prefetch" href="/assets/AIDevTrap.html-C-HQhiq0.js" as="script"><link rel="prefetch" href="/assets/AtomicGitCommits.html-VpQdPwXh.js" as="script"><link rel="prefetch" href="/assets/ExplainingRubySingletonClass.html-D9W7obeA.js" as="script"><link rel="prefetch" href="/assets/HowToLearnGit.html-CSR2ga0X.js" as="script"><link rel="prefetch" href="/assets/HowToNotUseYourBrain.html-rOPdEpoH.js" as="script"><link rel="prefetch" href="/assets/HowToStartCSS.html-DPznZxXK.js" as="script"><link rel="prefetch" href="/assets/ProductivityAndWellBeing.html-1n5NZ-Fo.js" as="script"><link rel="prefetch" href="/assets/TheHangoverTest.html-Di7Nh5Eg.js" as="script"><link rel="prefetch" href="/assets/MarieKondo.html-ObeJE8Lr.js" as="script"><link rel="prefetch" href="/assets/NetworkingIsNotWhatYouThink.html-BuCIMkBr.js" as="script"><link rel="prefetch" href="/assets/TechnicalDebtKitchen.html-CMQ1FZTc.js" as="script"><link rel="prefetch" href="/assets/WhatOpenSourceIs.html-b5sTn53O.js" as="script"><link rel="prefetch" href="/assets/WhyDiversityIsGreat.html-C7okgH5F.js" as="script"><link rel="prefetch" href="/assets/WhyOurWorkCultureSucks.html-BEzeygBR.js" as="script"><link rel="prefetch" href="/assets/BeginnersResources.html-CywoCBRr.js" as="script"><link rel="prefetch" href="/assets/DesignResources.html-BQxiW-1K.js" as="script"><link rel="prefetch" href="/assets/IntermediateResources.html-DE6zwc1Y.js" as="script"><link rel="prefetch" href="/assets/LLMResources.html-D4PnIrK1.js" as="script"><link rel="prefetch" href="/assets/SeniorResources.html-BJs8yhLX.js" as="script"><link rel="prefetch" href="/assets/BuildYourOwnSystem.html-Cn6Aln59.js" as="script"><link rel="prefetch" href="/assets/DebuggingSolrSunspot.html-Dec1LqM6.js" as="script"><link rel="prefetch" href="/assets/HowToUseSolrWithRails.html-DE77dpxD.js" as="script"><link rel="prefetch" href="/assets/TestAllYourRoutesInRails.html-CLTI49vi.js" as="script"><link rel="prefetch" href="/assets/TestingAnsibleScriptsWithVagrant.html-Dds0nuf2.js" as="script"><link rel="prefetch" href="/assets/UploadFilesFromVueToRails.html--i1uP2el.js" as="script"><link rel="prefetch" href="/assets/404.html-B9a58S7U.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">Such Dev Blog</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/WhoAmI.html" aria-label="Who am I ?"><!--[--><!--[--><!--]--><!--]-->Who am I ?<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Portfolio.html" aria-label="Portfolio"><!--[--><!--[--><!--]--><!--]-->Portfolio<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resources.html" aria-label="Resources"><!--[--><!--[--><!--]--><!--]-->Resources<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/lessons.html" aria-label="Lessons"><!--[--><!--[--><!--]--><!--]-->Lessons<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/opinions.html" aria-label="Opinions"><!--[--><!--[--><!--]--><!--]-->Opinions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/tutorials.html" aria-label="Tutorials"><!--[--><!--[--><!--]--><!--]-->Tutorials<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style="display:none;"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style=""><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/WhoAmI.html" aria-label="Who am I ?"><!--[--><!--[--><!--]--><!--]-->Who am I ?<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Portfolio.html" aria-label="Portfolio"><!--[--><!--[--><!--]--><!--]-->Portfolio<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/resources.html" aria-label="Resources"><!--[--><!--[--><!--]--><!--]-->Resources<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/lessons.html" aria-label="Lessons"><!--[--><!--[--><!--]--><!--]-->Lessons<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/opinions.html" aria-label="Opinions"><!--[--><!--[--><!--]--><!--]-->Opinions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/tutorials.html" aria-label="Tutorials"><!--[--><!--[--><!--]--><!--]-->Tutorials<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/WhoAmI.html" aria-label="Who am I ?"><!--[--><!--[--><!--]--><!--]-->Who am I ?<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/Portfolio.html" aria-label="Portfolio"><!--[--><!--[--><!--]--><!--]-->Portfolio<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Resources <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/resources/BeginnersResources.html" aria-label="👶 Resources for the Beginner WebDev"><!--[--><!--[--><!--]--><!--]-->👶 Resources for the Beginner WebDev<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/resources/IntermediateResources.html" aria-label="👩 Resources for the Intermediate WebDev"><!--[--><!--[--><!--]--><!--]-->👩 Resources for the Intermediate WebDev<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/resources/SeniorResources.html" aria-label="👴 Resources for the Senior WebDev"><!--[--><!--[--><!--]--><!--]-->👴 Resources for the Senior WebDev<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/resources/DesignResources.html" aria-label="🧑‍🎨 Design resources for WebDevs"><!--[--><!--[--><!--]--><!--]-->🧑‍🎨 Design resources for WebDevs<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/resources/LLMResources.html" aria-label="🤖 LLM / AI Resources"><!--[--><!--[--><!--]--><!--]-->🤖 LLM / AI Resources<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Lessons <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/AIDevTrap.html" aria-label="🤖 The AI development trap that wastes your time"><!--[--><!--[--><!--]--><!--]-->🤖 The AI development trap that wastes your time<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/TheHangoverTest.html" aria-label="🍻 Does your Pull Request pass the Hangover test?"><!--[--><!--[--><!--]--><!--]-->🍻 Does your Pull Request pass the Hangover test?<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/ProductivityAndWellBeing.html" aria-label="📈 Productivity and Well-being, A summary of what works."><!--[--><!--[--><!--]--><!--]-->📈 Productivity and Well-being, A summary of what works.<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/AtomicGitCommits.html" aria-label="⭐ Dramatically increase your productivity with Atomic Git Commits"><!--[--><!--[--><!--]--><!--]-->⭐ Dramatically increase your productivity with Atomic Git Commits<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/HowToLearnGit.html" aria-label="🧑‍💼 How to Learn Git Slowly"><!--[--><!--[--><!--]--><!--]-->🧑‍💼 How to Learn Git Slowly<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/HowToStartCSS.html" aria-label="😠 How to Start Learning CSS without hating yourself"><!--[--><!--[--><!--]--><!--]-->😠 How to Start Learning CSS without hating yourself<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/HowToNotUseYourBrain.html" aria-label="🧠 How to be a great software engineer without using your brain"><!--[--><!--[--><!--]--><!--]-->🧠 How to be a great software engineer without using your brain<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/lessons/ExplainingRubySingletonClass.html" aria-label="⁉️ Explaining Ruby&#39;s Singleton Class (Eigenclass) to confused beginners"><!--[--><!--[--><!--]--><!--]-->⁉️ Explaining Ruby&#39;s Singleton Class (Eigenclass) to confused beginners<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Opinions <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/opinions/TechnicalDebtKitchen.html" aria-label="🔪 The Technical Debt explained with a kitchen analogy"><!--[--><!--[--><!--]--><!--]-->🔪 The Technical Debt explained with a kitchen analogy<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/opinions/WhyOurWorkCultureSucks.html" aria-label="🪠 Why our work culture sucks"><!--[--><!--[--><!--]--><!--]-->🪠 Why our work culture sucks<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/opinions/MarieKondo.html" aria-label="🧹 The Marie Kondo guide for the Clean Developer"><!--[--><!--[--><!--]--><!--]-->🧹 The Marie Kondo guide for the Clean Developer<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/opinions/WhatOpenSourceIs.html" aria-label="💡What contributing to Open-source is, and what it isn&#39;t"><!--[--><!--[--><!--]--><!--]-->💡What contributing to Open-source is, and what it isn&#39;t<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/opinions/WhyDiversityIsGreat.html" aria-label="💵 Why diversity is important, no, really, actually for real"><!--[--><!--[--><!--]--><!--]-->💵 Why diversity is important, no, really, actually for real<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/opinions/NetworkingIsNotWhatYouThink.html" aria-label="🕸 Networking is easy, fun, and probably not what you think it is."><!--[--><!--[--><!--]--><!--]-->🕸 Networking is easy, fun, and probably not what you think it is.<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Tutorials <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/tutorials/BuildYourOwnSystem.html" aria-label="📐 Build your own system with ArchLinux"><!--[--><!--[--><!--]--><!--]-->📐 Build your own system with ArchLinux<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/tutorials/TestingAnsibleScriptsWithVagrant.html" aria-label="💽 Testing Ansible scripts with Vagrant"><!--[--><!--[--><!--]--><!--]-->💽 Testing Ansible scripts with Vagrant<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/tutorials/UploadFilesFromVueToRails.html" aria-label="💎 Upload Files from Vue.js to Rails with ActiveStorage"><!--[--><!--[--><!--]--><!--]-->💎 Upload Files from Vue.js to Rails with ActiveStorage<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/tutorials/FilterAnythingInRails.html" aria-label="💎 Filter Anything in a Rails request in 10 lines of code"><!--[--><!--[--><!--]--><!--]-->💎 Filter Anything in a Rails request in 10 lines of code<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/tutorials/TestAllYourRoutesInRails.html" aria-label="💎 Test all your GET routes in rails with 20 lines of code"><!--[--><!--[--><!--]--><!--]-->💎 Test all your GET routes in rails with 20 lines of code<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/tutorials/HowToUseSolrWithRails.html" aria-label="💎 How to use Solr / Sunspot with Rails"><!--[--><!--[--><!--]--><!--]-->💎 How to use Solr / Sunspot with Rails<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/tutorials/DebuggingSolrSunspot.html" aria-label="💎 Debugging Solr Sunspot like a pro"><!--[--><!--[--><!--]--><!--]-->💎 Debugging Solr Sunspot like a pro<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="💎-filter-anything-in-a-rails-request-with-almost-no-code" tabindex="-1"><a class="header-anchor" href="#💎-filter-anything-in-a-rails-request-with-almost-no-code"><span>💎 Filter anything in a Rails request with almost no code</span></a></h1><h2 id="context-what-and-why" tabindex="-1"><a class="header-anchor" href="#context-what-and-why"><span>Context (What and Why ?)</span></a></h2><p>One of my first missions in my webdev career was developing an Open Data API. Basically, you have this huge database of french companies, and what better way to support open data than building and hosting a cool Rails API where anyone can access the information ?</p><p>Since it was my first professional project, the API obviously wasn&#39;t as great as it could have been. One problem I often faced was enthusiastic users with very specialized needs. I had manually added a lot of options, but each user&#39;s needs were so specific it was often not enough.</p><p>Some time after, the data had switched format, and I used this opportunity to build a new version of the API. I decided it would be great to let the users filter their requests using any field in the database.</p><p><strong>tl;dr: Instead of bloating your controllers with filtering options, generate filters automatically based on your model&#39;s attributes !</strong></p><h2 id="introducing-has-scope" tabindex="-1"><a class="header-anchor" href="#introducing-has-scope"><span>Introducing : has_scope</span></a></h2><p>The brillant gem <a href="https://github.com/plataformatec/has_scope" target="_blank" rel="noopener noreferrer">has_scope</a> is built by the amazing team behind the famous gem Devise.</p><p>What it does : if you define an ActiveRecord scope in your models, you can allow your users to use them from your controllers.</p><p>You can go read the README, but basically, declaring <code>has_scope :is_open</code> in a Company controller and <code>scope :in_paris, -&gt;() (where(city: &#39;Paris&#39;))</code> in a Company model will allows your users to request only the companies from Paris :</p><p><code>GET /companies?in_paris</code></p><h2 id="making-it-bigger" tabindex="-1"><a class="header-anchor" href="#making-it-bigger"><span>Making it bigger</span></a></h2><p>This is all and well, but I have three tables in my database, each of them having 30 to 40 different fields. I&#39;m not going to copy-paste my scopes a hundred times.</p><p>I wrote the following controller and module concern for this purpose :</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb"><pre><code class="language-ruby"><span class="line"><span class="token keyword">module</span> <span class="token class-name">Scopable</span></span>
<span class="line">  <span class="token comment"># This part goes into your controllers</span></span>
<span class="line">  <span class="token keyword">module</span> <span class="token class-name">Controller</span></span>
<span class="line">    <span class="token keyword">extend</span> ActiveSupport<span class="token double-colon punctuation">::</span>Concern</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Add has_scope for each model attribute</span></span>
<span class="line">    included <span class="token keyword">do</span></span>
<span class="line">      <span class="token comment"># controller_name.classify.constantize =&gt; Get model class from controller</span></span>
<span class="line">      <span class="token comment"># You need to follow Rail&#39;s conventions for this to work</span></span>
<span class="line">      controller_name<span class="token punctuation">.</span>classify<span class="token punctuation">.</span>constantize<span class="token punctuation">.</span>attribute_names<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>a<span class="token operator">|</span></span>
<span class="line">        has_scope a<span class="token punctuation">.</span>to_sym<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token builtin">Hash</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token symbol">only</span><span class="token operator">:</span> <span class="token symbol">:show</span></span>
<span class="line">      <span class="token keyword">end</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># This part goes into your models</span></span>
<span class="line">  <span class="token keyword">module</span> <span class="token class-name">Model</span></span>
<span class="line">    <span class="token keyword">extend</span> ActiveSupport<span class="token double-colon punctuation">::</span>Concern</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Add scope for each model attribute</span></span>
<span class="line">    included <span class="token keyword">do</span></span>
<span class="line">      <span class="token comment"># Getting the model from itself is easier !</span></span>
<span class="line">      <span class="token keyword">self</span><span class="token punctuation">.</span>attribute_names<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>a<span class="token operator">|</span></span>
<span class="line">        scope a<span class="token punctuation">.</span>to_sym<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token builtin">Hash</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">end</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To use it, just include the right concern in model and controller :</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb"><pre><code class="language-ruby"><span class="line"><span class="token comment"># Model</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token operator">&lt;</span> ApplicationRecord</span>
<span class="line">  <span class="token keyword">include</span> Scopable<span class="token double-colon punctuation">::</span>Model</span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb"><pre><code class="language-ruby"><span class="line"><span class="token comment"># Controller</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CompanyController</span> <span class="token operator">&lt;</span> ApplicationController</span>
<span class="line">  <span class="token keyword">include</span> Scopable<span class="token double-colon punctuation">::</span>Controller</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">show</span></span></span>
<span class="line">    results <span class="token operator">=</span> apply_scopes<span class="token punctuation">(</span>Company<span class="token punctuation">)</span><span class="token punctuation">.</span>all</span>
<span class="line">    render json<span class="token operator">:</span> results<span class="token punctuation">,</span> <span class="token symbol">status</span><span class="token operator">:</span> <span class="token number">200</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now your users can filter any requests from any fields !</p><h2 id="security" tabindex="-1"><a class="header-anchor" href="#security"><span>Security</span></a></h2><p><code>has_scope</code> disallows use of hashes or arrays by default (although it is still possible to use them, as long as you predefine them). This removes the need for defining strong params.</p><h2 id="testing" tabindex="-1"><a class="header-anchor" href="#testing"><span>Testing</span></a></h2><p>The <code>Scopable</code> module is model-agnostic. Obviously, the tests should be as well. Now the best way would be to test it with a fake test class, but this would require registering a fake table in the test database, which is icky.</p><p>The other best way is to use Rspec&#39;s shared_examples :</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb"><pre><code class="language-ruby"><span class="line"><span class="token comment"># Need to pass in arguments the tested model, and two fields to test the filtering</span></span>
<span class="line">shared_examples <span class="token string-literal"><span class="token string">&#39;scopable&#39;</span></span> <span class="token keyword">do</span> <span class="token operator">|</span>model<span class="token punctuation">,</span> field_1<span class="token punctuation">,</span> field_2<span class="token operator">|</span></span>
<span class="line">  describe <span class="token string-literal"><span class="token string">&#39;#show&#39;</span></span><span class="token punctuation">,</span> <span class="token symbol">type</span><span class="token operator">:</span> <span class="token symbol">:request</span> <span class="token keyword">do</span></span>
<span class="line">    let<span class="token operator">!</span><span class="token punctuation">(</span><span class="token symbol">:instance_1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> create<span class="token punctuation">(</span>model<span class="token punctuation">,</span> field_1 <span class="token operator">=&gt;</span> <span class="token string-literal"><span class="token string">&#39;001&#39;</span></span><span class="token punctuation">,</span> field_2 <span class="token operator">=&gt;</span> <span class="token string-literal"><span class="token string">&#39;Foo&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    let<span class="token operator">!</span><span class="token punctuation">(</span><span class="token symbol">:instance_2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> create<span class="token punctuation">(</span>model<span class="token punctuation">,</span> field_1 <span class="token operator">=&gt;</span> <span class="token string-literal"><span class="token string">&#39;002&#39;</span></span><span class="token punctuation">,</span> field_2 <span class="token operator">=&gt;</span> <span class="token string-literal"><span class="token string">&#39;Bar&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    let<span class="token operator">!</span><span class="token punctuation">(</span><span class="token symbol">:instance_3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> create<span class="token punctuation">(</span>model<span class="token punctuation">,</span> field_1 <span class="token operator">=&gt;</span> <span class="token string-literal"><span class="token string">&#39;003&#39;</span></span><span class="token punctuation">,</span> field_2 <span class="token operator">=&gt;</span> <span class="token string-literal"><span class="token string">&#39;Bar&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    it <span class="token string-literal"><span class="token string">&#39;can filter with 1 field&#39;</span></span> <span class="token keyword">do</span></span>
<span class="line">      get <span class="token string-literal"><span class="token string">&quot;/</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">model<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">field_1<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">=001&quot;</span></span></span>
<span class="line"></span>
<span class="line">      expect<span class="token punctuation">(</span>json_response<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>to eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">      expect<span class="token punctuation">(</span>json_response<span class="token punctuation">.</span>first<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">field_1<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to eq<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;001&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">    it <span class="token string-literal"><span class="token string">&#39;can filter multiple fields&#39;</span></span> <span class="token keyword">do</span></span>
<span class="line">      get <span class="token string-literal"><span class="token string">&quot;/</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">model<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">field_1<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">=001&amp;</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">field_2<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">=Foo&quot;</span></span></span>
<span class="line"></span>
<span class="line">      expect<span class="token punctuation">(</span>json_response<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>to eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">      expect<span class="token punctuation">(</span>json_response<span class="token punctuation">.</span>first<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">field_1<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to eq<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;001&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">    it <span class="token string-literal"><span class="token string">&#39;can return multiple results&#39;</span></span> <span class="token keyword">do</span></span>
<span class="line">      get <span class="token string-literal"><span class="token string">&quot;/</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">model<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">field_2<span class="token punctuation">.</span>to_s</span><span class="token delimiter punctuation">}</span></span><span class="token string">=Bar&quot;</span></span></span>
<span class="line"></span>
<span class="line">      expect<span class="token punctuation">(</span>json_response<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>to eq<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And in the spec of any controller where you include the concern :</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb"><pre><code class="language-ruby"><span class="line"><span class="token comment"># Specs for CompanyController</span></span>
<span class="line"><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">&#39;rails_helper&#39;</span></span></span>
<span class="line"></span>
<span class="line">describe CompanyController <span class="token keyword">do</span></span>
<span class="line">  it_behaves_like <span class="token string-literal"><span class="token string">&#39;scopable&#39;</span></span><span class="token punctuation">,</span> <span class="token symbol">:company</span><span class="token punctuation">,</span> <span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token symbol">:name</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Don&#39;t forget also to index on your fields, or your requests will be very slow !</p><p>Hope you liked this bit of code !</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><time class="meta-item-info" datetime="2025-10-31T06:20:24.000Z" data-allow-mismatch>10/31/25, 6:20 AM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: samuel.faure.dev@gmail.com">Samuelfaure</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/tutorials/UploadFilesFromVueToRails.html" aria-label="💎 Upload Files from Vue.js to Rails with ActiveStorage"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">💎 Upload Files from Vue.js to Rails with ActiveStorage</span></div><!--]--></a><a class="route-link auto-link next" href="/tutorials/TestAllYourRoutesInRails.html" aria-label="💎 Test all your GET routes in rails with 20 lines of code"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">💎 Test all your GET routes in rails with 20 lines of code</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-wnH-bxgu.js" defer></script>
  </body>
</html>
